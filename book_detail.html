<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Details ¬∑ BookTrack</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link href="assets/css/styles.css" rel="stylesheet">
</head>
<body class="bt-theme d-flex flex-column min-vh-100">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <a class="bt-brand navbar-brand" href="index.html">
                <span class="bt-brand-mark">B</span>
                <span>BookTrack</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="user_Dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="book_search.html">Search Books</a></li>
                    <li class="nav-item"><a class="nav-link" href="my_Book.html">My Books</a></li>
                    <li class="nav-item"><a class="nav-link" href="notifications.html">Notifications</a></li>
                    <!-- Profile Dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="assets/img/profile-placeholder.png" alt="Profile" class="rounded-circle me-2" style="width:32px;height:32px;object-fit:cover;">
                            <span id="navbarFullName">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown" style="min-width:220px;">
                            <li class="px-3 py-2 text-center">
                                <img src="assets/img/profile-placeholder.png" alt="Profile" class="rounded-circle mb-2" style="width:56px;height:56px;object-fit:cover;">
                                <div class="fw-bold" id="dropdownFullName">User</div>
                                <div class="bt-muted small" id="dropdownEmail">user@example.com</div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item btn btn-bt w-100 text-center" href="profile.html">Go to Profile</a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#" id="logoutBtn">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="flex-grow-1 py-4">
        <div class="container">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="book_search.html" class="bt-link">Search Books</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Book Details</li>
                </ol>
            </nav>

            <!-- Book Details -->
            <div class="row" id="bookDetails">
                <!-- Loading spinner -->
                <div class="col-12 text-center" id="loadingSpinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 bt-muted">Loading book details...</p>
                </div>
            </div>

            <!-- Book not found message -->
            <div class="row d-none" id="bookNotFound">
                <div class="col-12">
                    <div class="bt-card p-5 text-center">
                        <div class="h4 bt-muted mb-3">üìö</div>
                        <h3 class="h5 bt-title mb-2">Book not found</h3>
                        <p class="bt-subtitle mb-0">The book you're looking for doesn't exist or has been removed.</p>
                        <a href="book_search.html" class="btn btn-bt mt-3">Back to Search</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-auto py-4 border-top text-center bt-muted">
        <div class="container">
            <p class="mb-1">&copy; 2025 BookTrack. All rights reserved.</p>
            <small>Made with ‚ù§Ô∏è using Bootstrap 5</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <script>
        // Sample book data (in a real app, this would come from an API)
        const sampleBooks = [
            {
                id: 1,
                title: "The Great Gatsby",
                author: "F. Scott Fitzgerald",
                isbn: "978-0743273565",
                category: "fiction",
                availability: "available",
                cover: "assets/img/Background.jpg",
                description: "A story of the fabulously wealthy Jay Gatsby and his love for the beautiful Daisy Buchanan. Set in the Jazz Age on Long Island, near New York City, the novel depicts first-person narrator Nick Carraway's interactions with mysterious millionaire Jay Gatsby and Gatsby's obsession to reunite with his former lover, Daisy Buchanan.",
                publishYear: 1925,
                pages: 180,
                language: "English",
                publisher: "Charles Scribner's Sons",
                genre: "Literary Fiction",
                rating: 4.2,
                reviews: 1250,
                location: "Main Library - Fiction Section",
                callNumber: "FIC FIT",
                addedDate: "2020-03-15",
                lastBorrowed: "2024-11-20",
                totalBorrows: 45
            },
            {
                id: 2,
                title: "To Kill a Mockingbird",
                author: "Harper Lee",
                isbn: "978-0446310789",
                category: "fiction",
                availability: "borrowed",
                cover: "assets/img/Background.jpg",
                description: "The story of young Scout Finch and her father Atticus in a racially divided Alabama town. Through the eyes of Scout, a feisty six-year-old tomboy, we see the world of Maycomb, Alabama, through her father's eyes as he defends a black man accused of a crime.",
                publishYear: 1960,
                pages: 281,
                language: "English",
                publisher: "J. B. Lippincott & Co.",
                genre: "Literary Fiction",
                rating: 4.3,
                reviews: 2100,
                location: "Main Library - Fiction Section",
                callNumber: "FIC LEE",
                addedDate: "2019-08-22",
                lastBorrowed: "2024-12-01",
                totalBorrows: 67,
                returnDate: "2024-12-15",
                borrowedBy: "John Smith"
            },
            {
                id: 3,
                title: "1984",
                author: "George Orwell",
                isbn: "978-0451524935",
                category: "fiction",
                availability: "reserved",
                cover: "assets/img/Background.jpg",
                description: "A dystopian novel about totalitarianism and surveillance society. The story follows the life of Winston Smith, a low-ranking member of 'the Party', who is frustrated by the omnipresent eyes of the party, and its sinister ruler Big Brother.",
                publishYear: 1949,
                pages: 328,
                language: "English",
                publisher: "Secker & Warburg",
                genre: "Dystopian Fiction",
                rating: 4.1,
                reviews: 1800,
                location: "Main Library - Fiction Section",
                callNumber: "FIC ORW",
                addedDate: "2021-01-10",
                lastBorrowed: "2024-10-15",
                totalBorrows: 38,
                reservedUntil: "2024-12-10",
                reservedBy: "Sarah Johnson"
            },
            {
                id: 4,
                title: "The Art of War",
                author: "Sun Tzu",
                isbn: "978-0140439199",
                category: "philosophy",
                availability: "available",
                cover: "assets/img/Background.jpg",
                description: "Ancient Chinese text on military strategy and tactics. The work contains a detailed explanation and analysis of the Chinese military, from weapons and strategy to rank and discipline.",
                publishYear: -500,
                pages: 273,
                language: "Chinese (Translated)",
                publisher: "Penguin Classics",
                genre: "Military Strategy",
                rating: 4.0,
                reviews: 890,
                location: "Main Library - Philosophy Section",
                callNumber: "355.02 SUN",
                addedDate: "2018-11-05",
                lastBorrowed: "2024-09-28",
                totalBorrows: 23
            },
            {
                id: 5,
                title: "Sapiens: A Brief History of Humankind",
                author: "Yuval Noah Harari",
                isbn: "978-0062316097",
                category: "non-fiction",
                availability: "available",
                cover: "assets/img/Background.jpg",
                description: "A groundbreaking narrative of humanity's creation and evolution. Harari explores the ways in which biology and history have defined us and enhanced our understanding of what it means to be 'human'.",
                publishYear: 2011,
                pages: 443,
                language: "English",
                publisher: "Harper",
                genre: "History",
                rating: 4.4,
                reviews: 3200,
                location: "Main Library - History Section",
                callNumber: "909 HAR",
                addedDate: "2022-06-18",
                lastBorrowed: "2024-11-25",
                totalBorrows: 89
            }
        ];

        // Check if user is logged in
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            const userRole = sessionStorage.getItem('userRole');
            
            if (!isLoggedIn || userRole !== 'user') {
                window.location.href = 'login.html';
                return;
            }
            
            // Display user info
            const userEmail = sessionStorage.getItem('userEmail');
            const userName = userEmail ? userEmail.split('@')[0] : 'User';
            document.getElementById('navbarFullName').textContent = userName;
        }

        // Fill navbar and dropdown with user info
        const userEmail = sessionStorage.getItem('userEmail') || 'user@example.com';
        const userFullName = sessionStorage.getItem('userFullName') || 'User';

        document.getElementById('navbarFullName').textContent = userFullName;
        document.getElementById('dropdownFullName').textContent = userFullName;
        document.getElementById('dropdownEmail').textContent = userEmail;

        // Get book ID from URL parameters
        function getBookId() {
            const urlParams = new URLSearchParams(window.location.search);
            return parseInt(urlParams.get('id'));
        }

        // Load book details
        function loadBookDetails() {
            const bookId = getBookId();
            const book = sampleBooks.find(b => b.id === bookId);

            if (!book) {
                document.getElementById('loadingSpinner').classList.add('d-none');
                document.getElementById('bookNotFound').classList.remove('d-none');
                return;
            }

            displayBookDetails(book);
        }

        function displayBookDetails(book) {
            const detailsContainer = document.getElementById('bookDetails');
            
            const availabilityBadgeClass = getAvailabilityBadgeClass(book.availability);
            const availabilityText = getAvailabilityText(book.availability);
            
            const detailsHTML = `
                <div class="col-lg-4 mb-4">
                    <div class="bt-card p-4 text-center">
                        <div class="book-cover-large mb-3">
                            <img src="${book.cover}" alt="${book.title}" class="img-fluid">
                        </div>
                        <div class="d-grid gap-2">
                            ${getActionButtons(book)}
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-8">
                    <div class="bt-card p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h1 class="h2 bt-title mb-2">${book.title}</h1>
                                <p class="h5 bt-muted mb-3">by ${book.author}</p>
                            </div>
                            <div class="text-end">
                                <span class="badge ${availabilityBadgeClass} fs-6">${availabilityText}</span>
                            </div>
                        </div>
                        
                        <div class="book-meta mb-4">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">ISBN:</strong>
                                        <span>${book.isbn}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Category:</strong>
                                        <span class="badge bg-secondary">${book.category}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Genre:</strong>
                                        <span>${book.genre}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Publisher:</strong>
                                        <span>${book.publisher}</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Published:</strong>
                                        <span>${book.publishYear}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Pages:</strong>
                                        <span>${book.pages}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Language:</strong>
                                        <span>${book.language}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Rating:</strong>
                                        <span>‚≠ê ${book.rating}/5 (${book.reviews} reviews)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="h5 bt-title mb-2">Description</h4>
                            <p class="mb-0">${book.description}</p>
                        </div>
                        
                        <div class="book-meta mb-4">
                            <h4 class="h5 bt-title mb-3">Library Information</h4>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Location:</strong>
                                        <span>${book.location}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Call Number:</strong>
                                        <span class="badge bg-light text-dark">${book.callNumber}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Added:</strong>
                                        <span>${formatDate(book.addedDate)}</span>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Total Borrows:</strong>
                                        <span>${book.totalBorrows}</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="me-2">Last Borrowed:</strong>
                                        <span>${formatDate(book.lastBorrowed)}</span>
                                    </div>
                                    ${getAvailabilityDetails(book)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            detailsContainer.innerHTML = detailsHTML;
            document.getElementById('loadingSpinner').classList.add('d-none');
        }

        function getActionButtons(book) {
            let buttons = '';
            
            switch(book.availability) {
                case 'available':
                    buttons = `
                        <button class="btn btn-bt" onclick="borrowBook(${book.id})">
                            <i class="bi bi-book"></i> Borrow Book
                        </button>
                        <button class="btn btn-outline-info" onclick="reserveBook(${book.id})">
                            <i class="bi bi-clock"></i> Reserve
                        </button>
                        <button class="btn btn-outline-secondary" onclick="toggleBookmark(${book.id})">
                            <i class="bi bi-bookmark"></i> Bookmark
                        </button>
                    `;
                    break;
                case 'borrowed':
                    buttons = `
                        <button class="btn btn-outline-warning" disabled>
                            <i class="bi bi-clock"></i> Currently Borrowed
                        </button>
                        <button class="btn btn-outline-info" onclick="reserveBook(${book.id})">
                            <i class="bi bi-clock"></i> Reserve When Available
                        </button>
                        <button class="btn btn-outline-secondary" onclick="toggleBookmark(${book.id})">
                            <i class="bi bi-bookmark"></i> Bookmark
                        </button>
                    `;
                    break;
                case 'reserved':
                    buttons = `
                        <button class="btn btn-outline-info" disabled>
                            <i class="bi bi-clock"></i> Currently Reserved
                        </button>
                        <button class="btn btn-outline-secondary" onclick="toggleBookmark(${book.id})">
                            <i class="bi bi-bookmark"></i> Bookmark
                        </button>
                    `;
                    break;
                default:
                    buttons = `
                        <button class="btn btn-outline-secondary" onclick="toggleBookmark(${book.id})">
                            <i class="bi bi-bookmark"></i> Bookmark
                        </button>
                    `;
            }
            
            return buttons;
        }

        function getAvailabilityDetails(book) {
            switch(book.availability) {
                case 'borrowed':
                    return `
                        <div class="d-flex align-items-center mb-2">
                            <strong class="me-2">Return Date:</strong>
                            <span class="text-warning">${formatDate(book.returnDate)}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <strong class="me-2">Borrowed By:</strong>
                            <span>${book.borrowedBy}</span>
                        </div>
                    `;
                case 'reserved':
                    return `
                        <div class="d-flex align-items-center mb-2">
                            <strong class="me-2">Reserved Until:</strong>
                            <span class="text-info">${formatDate(book.reservedUntil)}</span>
                        </div>
                        <div class="d-flex align-items-center mb-2">
                            <strong class="me-2">Reserved By:</strong>
                            <span>${book.reservedBy}</span>
                        </div>
                    `;
                default:
                    return '';
            }
        }

        function getAvailabilityBadgeClass(availability) {
            switch(availability) {
                case 'available': return 'bg-success';
                case 'borrowed': return 'bg-warning';
                case 'reserved': return 'bg-info';
                default: return 'bg-secondary';
            }
        }

        function getAvailabilityText(availability) {
            switch(availability) {
                case 'available': return 'Available';
                case 'borrowed': return 'Borrowed';
                case 'reserved': return 'Reserved';
                default: return 'Unknown';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function borrowBook(bookId) {
            if (confirm('Are you sure you want to borrow this book?')) {
                alert(`Book borrowed successfully! Book ID: ${bookId}`);
                // In a real app, this would make an API call
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        function reserveBook(bookId) {
            if (confirm('Are you sure you want to reserve this book?')) {
                alert(`Book reserved successfully! Book ID: ${bookId}`);
                // In a real app, this would make an API call
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }
        }

        function toggleBookmark(bookId) {
            alert(`Bookmark toggled for book ID: ${bookId}`);
        }

        // Logout function
        function logout() {
            sessionStorage.clear();
            window.location.href = 'login.html';
        }

        // Event listeners
        document.getElementById('logoutBtn').addEventListener('click', logout);

        // Initialize page
        checkAuth();
        loadBookDetails();
    </script>
</body>
</html>
